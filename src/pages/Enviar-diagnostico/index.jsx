import React, { Component } from 'react'
import {
    BrowserRouter as Router, Switch, Route, Link
} from "react-router-dom";

import Menu from '../Main/templates/Menu-Vertical/medico/menu-Vertical'
import Logout from '../Main/templates/Logout/index'
import BadRequest from '../Main/templates/Redirect/index'
import Medico from '../../service/medico'
import User from '../../service/users'


class index extends Component {

    constructor(props) {
        super(props)
        this.state = {
            appointments: [],
            user: {}
        }
        this.getValuesPatient = this.getValuesPatient.bind(this);
    }

    componentDidMount = async function () {
        const id = localStorage.getItem('id')
        const response = await Medico.listAppointmentMedic(id);
        this.setState({ appointments: response.data.appointments });
    }

    getValuesPatient = async function (id) {
        const response = await User.byId(id);
        this.setState({ user: response.data });
        console.log(response.data);
        return response.data.name
    }

    renderInfo(patientId, appointmentId){
        localStorage.setItem('patientId', patientId)
        localStorage.setItem('appointmentId', appointmentId)
    }

    render() {
        const session = localStorage.getItem('session')
        const type = localStorage.getItem("type")
        if (session === "true" && type === '1') {
            const { appointments } = this.state;
            return (
                <div className='flex'>
                    <Menu />
                    <div className='grid-minhas-consultas'>
                        <div>
                            <Logout />
                        </div>
                        <div className='margin-minhas-consultas'>
                            <h2>Enviar diagnóstico</h2>
                        </div>
                        <div className='borda-meus-pacientes'>
                            <table id="customers">
                                <tr>
                                    <th>Paciente</th>
                                    <th>Data</th>
                                    <th>Hora</th>
                                    <th>Local</th>
                                    <th></th>
                                </tr>
                                {appointments.map(appointment => {
                                    const newDate = new Date(appointment.time)
                                    const day = newDate.getUTCDate();
                                    const month = newDate.getUTCMonth() + 1;
                                    const hours = newDate.getUTCHours() + 3;
                                    const minutes = newDate.getUTCMinutes();
                                    return (
                                        <tr className='text-center' key={appointment.appointmentId}>
                                            <td>Jose Sebastiao da Silva</td>
                                            <td>{day}/{month}</td>
                                            <td>{hours}:{minutes}</td>
                                            <td>Hospital das Clínicas - Crateús</td>
                                            <td className='table-select-patient '>
                                                <Link className='reset-link-menu' 
                                                onClick={() => 
                                     this.renderInfo(appointment.patientId, appointment.appointmentId)}
                                                    to='enviar-diagnostico'>
                                                    <svg width="60" height="70" viewBox="0 0 500 428" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M250 376.942C339.852 376.942 412.691 304.103 412.691 214.251C412.691 124.399 339.852 51.5596 250 51.5596C160.148 51.5596 87.3087 124.399 87.3087 214.251C87.3087 304.103 160.148 376.942 250 376.942Z" stroke="#555555" stroke-width="14.6177"/>
<path d="M151.356 131.911C146.234 131.911 142.106 136.039 142.106 141.162V287.338C142.106 292.461 146.234 296.589 151.356 296.589H258.756C263.879 296.589 268.007 292.461 268.007 287.338V141.162C268.007 136.039 263.879 131.911 258.756 131.911H151.356ZM173.838 148.834H253.993V157.687H173.838V148.834V148.834ZM160.538 148.861C161.121 148.861 161.698 148.975 162.236 149.197C162.774 149.42 163.263 149.746 163.675 150.158C164.087 150.57 164.414 151.059 164.636 151.597C164.859 152.135 164.973 152.712 164.972 153.295C164.971 153.876 164.855 154.451 164.632 154.988C164.409 155.525 164.082 156.012 163.67 156.423C163.259 156.833 162.77 157.158 162.233 157.38C161.695 157.602 161.12 157.715 160.538 157.714C159.367 157.713 158.244 157.246 157.415 156.418C156.587 155.589 156.121 154.466 156.119 153.295C156.118 152.713 156.231 152.138 156.453 151.6C156.675 151.063 157 150.574 157.41 150.163C157.821 149.751 158.308 149.424 158.845 149.201C159.382 148.978 159.957 148.862 160.538 148.861V148.861ZM173.838 166.251H253.993V175.105H173.838V166.251V166.251ZM160.223 166.293C160.328 166.289 160.433 166.289 160.539 166.293C161.12 166.292 161.696 166.406 162.233 166.627C162.77 166.849 163.259 167.174 163.671 167.584C164.082 167.995 164.409 168.482 164.632 169.019C164.856 169.556 164.971 170.131 164.972 170.713C164.973 171.295 164.859 171.872 164.636 172.41C164.414 172.948 164.087 173.438 163.675 173.849C163.264 174.261 162.774 174.588 162.236 174.81C161.698 175.033 161.121 175.147 160.539 175.146C159.957 175.145 159.382 175.03 158.845 174.806C158.308 174.583 157.821 174.256 157.411 173.845C157 173.433 156.675 172.944 156.453 172.407C156.232 171.87 156.118 171.294 156.119 170.713C156.118 169.594 156.54 168.516 157.302 167.696C158.063 166.876 159.107 166.374 160.223 166.293H160.223ZM173.838 183.67H253.993V192.523H173.838V183.67V183.67ZM160.538 183.711C161.12 183.71 161.695 183.824 162.233 184.045C162.77 184.267 163.259 184.592 163.67 185.003C164.082 185.413 164.409 185.9 164.632 186.437C164.855 186.974 164.971 187.549 164.972 188.131C164.973 188.713 164.859 189.29 164.636 189.828C164.414 190.367 164.087 190.856 163.675 191.267C163.263 191.679 162.774 192.006 162.236 192.228C161.698 192.451 161.121 192.565 160.538 192.564C159.957 192.563 159.382 192.448 158.845 192.224C158.308 192.001 157.821 191.674 157.41 191.263C157 190.851 156.675 190.362 156.453 189.825C156.231 189.288 156.118 188.712 156.119 188.131C156.121 186.959 156.587 185.836 157.415 185.007C158.244 184.179 159.367 183.713 160.538 183.711V183.711ZM173.838 201.101H253.993V209.954H173.838V201.101V201.101ZM160.538 201.128C161.121 201.128 161.698 201.242 162.236 201.464C162.774 201.686 163.263 202.013 163.675 202.425C164.087 202.837 164.414 203.326 164.636 203.864C164.859 204.402 164.973 204.979 164.972 205.562C164.971 206.143 164.855 206.718 164.632 207.255C164.409 207.792 164.082 208.279 163.67 208.69C163.259 209.1 162.77 209.425 162.233 209.647C161.695 209.869 161.12 209.982 160.538 209.981C159.367 209.98 158.244 209.513 157.415 208.685C156.587 207.856 156.121 206.733 156.119 205.562C156.118 204.98 156.231 204.405 156.453 203.867C156.675 203.33 157 202.841 157.41 202.43C157.821 202.018 158.308 201.691 158.845 201.468C159.382 201.245 159.957 201.129 160.538 201.128V201.128ZM173.838 218.518H253.993V227.372H173.838V218.518V218.518ZM160.538 218.546C161.121 218.545 161.698 218.659 162.236 218.881C162.774 219.104 163.263 219.43 163.675 219.842C164.087 220.254 164.414 220.743 164.636 221.282C164.859 221.82 164.973 222.397 164.972 222.979C164.971 223.56 164.855 224.136 164.632 224.673C164.409 225.209 164.082 225.697 163.67 226.107C163.259 226.518 162.77 226.843 162.233 227.064C161.695 227.286 161.12 227.4 160.538 227.399C159.367 227.397 158.244 226.931 157.415 226.102C156.587 225.274 156.121 224.151 156.119 222.979C156.118 222.398 156.231 221.822 156.453 221.285C156.675 220.747 157 220.259 157.41 219.847C157.821 219.435 158.308 219.109 158.845 218.885C159.382 218.662 159.957 218.547 160.538 218.546V218.546ZM173.838 235.936H253.993V244.789H173.838V235.936V235.936ZM160.223 235.977C160.328 235.974 160.433 235.974 160.539 235.977C161.12 235.976 161.696 236.09 162.233 236.312C162.77 236.533 163.259 236.859 163.671 237.269C164.082 237.679 164.409 238.167 164.632 238.703C164.856 239.24 164.971 239.816 164.972 240.397C164.973 240.979 164.859 241.556 164.636 242.095C164.414 242.633 164.087 243.122 163.675 243.534C163.264 243.946 162.774 244.272 162.236 244.495C161.698 244.717 161.121 244.831 160.539 244.83C159.957 244.829 159.382 244.714 158.845 244.491C158.308 244.267 157.821 243.941 157.411 243.529C157 243.117 156.675 242.629 156.453 242.091C156.232 241.554 156.118 240.978 156.119 240.397C156.118 239.278 156.54 238.2 157.302 237.38C158.063 236.56 159.107 236.059 160.223 235.977H160.223ZM173.838 253.354H253.993V262.207H173.838V253.354V253.354ZM160.538 253.395C161.12 253.395 161.695 253.508 162.233 253.73C162.77 253.951 163.259 254.277 163.67 254.687C164.082 255.097 164.409 255.585 164.632 256.122C164.855 256.658 164.971 257.234 164.972 257.815C164.973 258.397 164.859 258.974 164.636 259.513C164.414 260.051 164.087 260.54 163.675 260.952C163.263 261.364 162.774 261.69 162.236 261.913C161.698 262.135 161.121 262.249 160.538 262.248C159.957 262.247 159.382 262.132 158.845 261.909C158.308 261.686 157.821 261.359 157.41 260.947C157 260.535 156.675 260.047 156.453 259.509C156.231 258.972 156.118 258.396 156.119 257.815C156.121 256.643 156.587 255.52 157.415 254.692C158.244 253.863 159.367 253.397 160.538 253.395V253.395ZM173.838 270.785H253.993V279.639H173.838V270.785V270.785ZM160.538 270.813C161.121 270.812 161.698 270.926 162.236 271.148C162.774 271.371 163.263 271.697 163.675 272.109C164.087 272.521 164.414 273.01 164.636 273.548C164.859 274.087 164.973 274.664 164.972 275.246C164.971 275.827 164.855 276.403 164.632 276.94C164.409 277.476 164.082 277.964 163.67 278.374C163.259 278.785 162.77 279.11 162.233 279.331C161.695 279.553 161.12 279.667 160.538 279.666C159.367 279.664 158.244 279.198 157.415 278.369C156.587 277.541 156.121 276.418 156.119 275.246C156.118 274.665 156.231 274.089 156.453 273.552C156.675 273.014 157 272.526 157.41 272.114C157.821 271.702 158.308 271.376 158.845 271.152C159.382 270.929 159.957 270.814 160.538 270.813V270.813Z" fill="#555555"/>
<path d="M288.91 217.352C288.91 219.121 290.334 220.546 292.103 220.546H356.084L340.612 236.012C339.986 236.638 339.674 237.451 339.674 238.268C339.674 239.084 339.986 239.897 340.612 240.523L345.721 245.632C346.972 246.883 348.987 246.883 350.238 245.632L371.632 224.238L375.064 220.812C375.071 220.805 375.077 220.798 375.084 220.792C375.091 220.785 375.098 220.779 375.104 220.772L378.617 217.26C378.617 217.26 380.257 215.646 380.257 213.741C380.257 211.852 378.597 210.208 378.597 210.208L375.064 206.669L350.239 181.844C348.988 180.593 346.973 180.593 345.722 181.844L340.613 186.953C339.362 188.204 339.362 190.212 340.613 191.463L356.085 206.935H292.104C290.335 206.935 288.911 208.359 288.911 210.128L288.91 217.352Z" fill="#555555"/>
</svg>
                                                </Link>
                                            </td>
                                        </tr>
                                    )
                                })}
                            </table>

                        </div>
                    </div>
                </div>
            )
        }
        if (session != "true" || type === '0') {
            return (
                <BadRequest />
            )
        }
    }
}

export default index;